<!DOCTYPE html><?phpinclude "../handler/DBHandler.php";define('IMG_DIR', 'http://eventcoordinator.000webhostapp.com/images/');$db = new DbHandler();session_start();if (!isset($_SESSION["company"])) {    header("Location: signin.php");    exit();} else {    $company = $_SESSION["company"];}?><html lang="en"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="description" content="">    <meta name="author" content="">    <link rel="icon" href="../../favicon.ico">    <title>My Event</title>    <!-- Bootstrap core CSS -->    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"          integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">    <style type="text/css">        /*     * Base structure     */        /* Move down content because we have a fixed navbar that is 50px tall */        body {            padding-top: 50px;        }        /*         * Typography         */        h1 {            margin-bottom: 20px;            padding-bottom: 9px;            border-bottom: 1px solid #eee;        }        /*         * Sidebar         */        .sidebar {            position: fixed;            top: 51px;            bottom: 0;            left: 0;            z-index: 1000;            padding: 20px;            overflow-x: hidden;            overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */            border-right: 1px solid #eee;        }        /* Sidebar navigation */        .sidebar {            padding-left: 0;            padding-right: 0;        }        .sidebar .nav {            margin-bottom: 20px;        }        .sidebar .nav-item {            width: 100%;        }        .sidebar .nav-item + .nav-item {            margin-left: 0;        }        .sidebar .nav-link {            border-radius: 0;        }        /*         * Dashboard         */        /* Placeholders */        .placeholders {            padding-bottom: 3rem;        }        .placeholder img {            padding-top: 1.5rem;            padding-bottom: 1.5rem;        }        #yourElement {            -webkit-background-size: cover;            -moz-background-size: cover;            -o-background-size: cover;            background-size: cover;            height: 232px;        }    </style></head><body><nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">    <a class="navbar-brand" href="overview.php">My Event</a>    <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse"            data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false"            aria-label="Toggle navigation">        <span class="navbar-toggler-icon"></span>    </button>    <div class="collapse navbar-collapse hidden-lg-up" id="navbarsExampleDefault">        <ul class="navbar-nav mr-auto ">            <li class="nav-item active">                <a class="nav-link" href="../handler/signout.php" aria-haspopup="true" aria-expanded="false"                   onclick="return signout_dialog()">                    Sign Out                </a>            </li>        </ul>    </div></nav><div class="container-fluid">    <div class="row">        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">            <ul class="nav nav-pills flex-column">                <li class="nav-item">                    <a class="nav-link" href="overview.php">Overview</a>                </li>                <li class="nav-item">                    <a class="nav-link active" href="packages.php">Packages</a>                </li>                <li class="nav-item">                    <a class="nav-link" href="categories.php">Category</a>                </li>                <li class="nav-item">                    <a class="nav-link" href="items.php">Items</a>                </li>            </ul>        </nav>        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">            <h2 style="margin-top: 10px;"><?php echo $company->company_name; ?></h2>            <hr>            <div class="row">                <?php if (isset($_SESSION['upload'])) {                    if ($_SESSION['upload']) { ?>                        <div class="col-sm-3 offset-sm-6">                            <div id="uploadAlert" class="alert alert-success alert-dismissible fade show" role="alert">                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">                                    <span aria-hidden="true">&times;</span>                                </button>                                <strong>Success!</strong> Uploaded image.                            </div>                        </div>                        <?php                        unset($_SESSION['upload']);                    } else { ?>                        <div class="col-sm-3 offset-sm-6">                            <div id="uploadAlert" class="alert alert-danger alert-dismissible fade show" role="alert">                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">                                    <span aria-hidden="true">&times;</span>                                </button>                                <strong>Error!</strong> Unable to upload image.                            </div>                        </div>                        <?php                        unset($_SESSION['upload']);                    }                }                ?>                <?php                if (isset($_SESSION['action'])) {                    if ($_SESSION['action']) { ?>                        <div class="col-sm-3">                            <div id="addedAlert" class="alert alert-success alert-dismissible fade show" role="alert">                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">                                    <span aria-hidden="true">&times;</span>                                </button>                                <strong>Success!</strong> Package added successfully.                            </div>                        </div>                        <?php                        unset($_SESSION['action']);                    } else {                        ?>                        <div class="col-sm-3">                            <div id="addedAlert" class="alert alert-danger alert-dismissible fade show" role="alert">                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">                                    <span aria-hidden="true">&times;</span>                                </button>                                <strong>Error!</strong> DB saving error.                            </div>                        </div>                        <?php                        unset($_SESSION['action']);                    }                }                ?>            </div>            <table class="table table-hover table-sm">                <thead class="thead-inverse">                <tr>                    <th>Package ID</th>                    <th>Package Name</th>                    <th>Package Type</th>                    <th>Package Price</th>                    <th></th>                </tr>                </thead>                <tbody>                <?php                $packages = $db->getAllCompanyPackages($company->company_id);                $x = 0;                foreach ($packages as $package) {                    ?>                    <tr>                        <td id="package_id<?php echo $x; ?>"><?php echo $package->package_id; ?></td>                        <td><?php echo $package->package_name; ?></td>                        <td><?php echo $package->package_type; ?></td>                        <td><?php echo $package->package_price; ?></td>                        <td>                            <div class="dropdown">                                <a class="btn btn-secondary dropdown-toggle" href="" id="dropdownMenuLink"                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                                    Action                                </a>                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">                                    <a class="dropdown-item" onclick="showEditModal(package_id<?php echo $x; ?>)"                                       href="#">Edit</a>                                    <a class="dropdown-item" onclick="showDeleteModal(package_id<?php echo $x; ?>)"                                       href="#">Delete</a>                                </div>                            </div>                        </td>                    </tr>                    <?php                    $x++;                }                ?>                <tr class="table-warning" style="cursor: pointer" id="add">                    <td>                        <h6>Add new package</h6>                    </td>                    <td></td>                    <td></td>                    <td></td>                    <td></td>                </tr>                </tbody>            </table>        </main>    </div></div><div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel">    <div class="modal-dialog" role="document">        <div class="modal-content">            <div class="modal-header">                <h5 class="modal-title">New Package</h5>                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                    <span aria-hidden="true">&times;</span>                </button>            </div>            <form action="../handler/addPackage.php" id="form_addPackage" method="post" enctype="multipart/form-data">                <div class="modal-body" style="padding: 7%">                    <div id="p_name_group" class="input-group">                        <span class="input-group-addon" id="basic-addon1">Package Name</span>                        <input type="text" id='package_name' name="package_name" class="form-control"                               placeholder="E.g. Birthday Bash"                               aria-describedby="basic-addon1">                    </div>                    <div class="input-group" style="margin-top: 5%">                        <span class="input-group-addon" id="basic-addon1">Package Type</span>                        <select id="package_type" name="package_type" class="form-control" id="sel1">                            <?php                            $package_types = $db->getDistinctPackageType();                            foreach ($package_types as $type) {                                ?>                                <option><?php echo $type->package_type; ?></option>                                <?php                            }                            ?>                        </select>                    </div>                    <div id="p_price_group" class="input-group" style="margin-top: 5%">                        <span class="input-group-addon">Package Price</span>                        <input type="number" id="package_price" name="package_price" min="1" class="form-control"                               aria-label="PHP">                    </div>                    <div class="input-group" style="margin-top: 5%">                    <span class="input-group-btn">                      <button class="btn btn-secondary" style="cursor: pointer" id="get_file" type="button">Choose image</button>                    </span>                        <input type="text" id="text_image" class="form-control" readonly placeholder="...">                        <input type="file" accept="image/*" name="package_image" id="my_file" class="form-control"                               style="display: none">                    </div>                    <div id="progress_div" class="progress" style="margin-top: 5%">                    </div>                </div>                <div class="modal-footer">                    <button type="button" style="cursor: pointer" id="btn_save" class="btn btn-primary">Save changes                    </button>                    <button type="button" style="cursor: pointer" class="btn btn-secondary" data-dismiss="modal">Close                    </button>                </div>            </form>        </div>    </div></div><div class="modal fade" id="deleteModal">    <div class="modal-dialog" role="document">        <div class="modal-content">            <div class="modal-header">                <h5 class="modal-title">Delete Package</h5>                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                    <span aria-hidden="true">&times;</span>                </button>            </div>            <div class="modal-body">                <p>Do you really want to delete package?</p>            </div>            <div class="modal-footer">                <button type="button" style="cursor: pointer" id="deleteBtn" class="btn btn-danger">Delete</button>                <button type="button" style="cursor: pointer" class="btn btn-secondary" data-dismiss="modal">Close                </button>            </div>        </div>    </div></div><div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">    <div class="modal-dialog" role="document">        <div class="modal-content">            <div class="modal-header">                <h5 class="modal-title">Edit Package</h5>                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                    <span aria-hidden="true">&times;</span>                </button>            </div>            <form action="../handler/editPackage.php" id="form_editPackage" method="post" enctype="multipart/form-data">                <div class="modal-body" style="padding: 7%">                    <input type="text" id="package_id_edit" name="package_id_edit" class="form-control"                           style="visibility: hidden" readonly placeholder="">                    <div id="p_name_edit_group" class="input-group">                        <span class="input-group-addon" id="basic-addon1">Package Name</span>                        <input type="text" id='package_name_edit' name="package_name_edit" class="form-control"                               aria-describedby="basic-addon1">                        </input>                    </div>                    <div class="input-group" style="margin-top: 5%">                        <span class="input-group-addon" id="basic-addon1">Package Type</span>                        <select id="package_type_edit" name="package_type_edit" class="form-control" id="sel1">                            <?php                            $package_types = $db->getDistinctPackageType();                            foreach ($package_types as $type) {                                ?>                                <option><?php echo $type->package_type; ?></option>                                <?php                            }                            ?>                        </select>                    </div>                    <div id="p_price_edit_group" class="input-group" style="margin-top: 5%">                        <span class="input-group-addon">Package Price</span>                        <input type="number" id="package_price_edit" name="package_price_edit" min="1"                               class="form-control"                               aria-label="PHP">                    </div>                    <div class="input-group" style="margin-top: 5%">                    <span class="input-group-btn">                      <button class="btn btn-secondary" style="cursor: pointer" id="get_file_edit" type="button">Choose image</button>                    </span>                        <input type="text" id="text_image_edit" class="form-control" readonly placeholder="...">                        <input type="file" accept="image/*" name="package_image_edit" id="my_file_edit"                               class="form-control"                               style="display: none">                    </div>                    <div id="progress_div_edit" class="progress" style="margin-top: 5%">                    </div>                </div>                <div class="modal-footer">                    <button type="button" style="cursor: pointer" id="btn_save_edit" class="btn btn-primary">Save                        changes                    </button>                    <button type="button" style="cursor: pointer" class="btn btn-secondary" data-dismiss="modal">Close                    </button>                </div>            </form>        </div>    </div></div><!-- Bootstrap core JavaScript================================================== --><!-- Placed at the end of the document so the pages load faster --><script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"        integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"        crossorigin="anonymous"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"        crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"        integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"        crossorigin="anonymous"></script><script>    var check_input_arr = new Array();    $(function () {        $("#add").on('click', function () {            $('#addModal').modal({backdrop: 'static', keyboard: false})        })        $("#btn_save").on('click', function () {            check_input_arr = new Array();            var p_name = $("#package_name").val()            var p_type = $('#package_type').find(":selected").text();            var p_price = $("#package_price").val()            var p_image = $('#text_image').val()            check_p_name(p_name)            check_p_type(p_type)            check_p_price(p_price)            check_p_image(p_image)            if (!check_input_arr.includes(false)) {                showProgressBar()                $('#form_addPackage').submit()            }        })        $("#btn_save_edit").on('click', function () {            check_input_arr = new Array();            var p_name = $("#package_name_edit").val()            var p_type = $('#package_type_edit').find(":selected").text();            var p_price = $("#package_price_edit").val()            var p_image = $('#text_image_edit').val()            check_p_name_edit(p_name)            check_p_type_edit(p_type)            check_p_price_edit(p_price)            check_p_image_edit(p_image)            if (!check_input_arr.includes(false)) {                showProgressBarEdit()                $('#form_editPackage').submit()            }        })    })    function showEditModal(x) {        $.ajax({            type: 'POST',            url: '../handler/getPackage.php',            data: {                'package_id': $(x).text()            },            success: function (data) {                var details = JSON.parse(data)                $('#package_name_edit').val(details.package_name)                $('#package_id_edit').val(details.package_id)                $('#package_price_edit').val(details.package_price)                $('#package_type_edit').val(details.package_type)            }        });        $('#editModal').modal({backdrop: 'static', keyboard: false})    }    function showDeleteModal(x) {        $('#deleteModal').modal({backdrop: 'static', keyboard: false})        $('#deleteBtn').on('click', function () {            $('#deleteModal').modal('toggle');            $.ajax({                type: 'POST',                url: '../handler/deletePackage.php',                data: {                    'package_id': $(x).text()                },                success: function (data) {                    if (data) {                        window.location.reload()                    }                }            });        })    }    function check_p_name_edit(p_name) {        if (!p_name) {            $("#p_name_edit_group").addClass("has-danger")            $("#package_name_edit").addClass("form-control-danger")            check_input_arr.push(false)        } else {            $("#p_name_edit_group").removeClass("has-danger")            $("#package_name_edit").removeClass("form-control-danger")            check_input_arr.push(true)        }    }    function check_p_type_edit(p_type) {        if (!p_type) {            check_input_arr.push(false)        } else {            check_input_arr.push(true)        }    }    function check_p_price_edit(p_price) {        if (!p_price || p_price < 1 || p_price > 10000000) {            $("#p_price_edit_group").addClass("has-danger")            $("#package_price_edit").addClass("form-control-danger")            check_input_arr.push(false)        } else {            $("#p_price_edit_group").removeClass("has-danger")            $("#package_price_edit").removeClass("form-control-danger")            check_input_arr.push(true)        }    }    function check_p_image_edit(p_image) {        if (!p_image) {            check_input_arr.push(false)            alert("Invalid file");            e.preventDefault();        } else {            check_input_arr.push(true)        }    }    function check_p_name(p_name) {        if (!p_name) {            $("#p_name_group").addClass("has-danger")            $("#package_name").addClass("form-control-danger")            check_input_arr.push(false)        } else {            $("#p_name_group").removeClass("has-danger")            $("#package_name").removeClass("form-control-danger")            check_input_arr.push(true)        }    }    function check_p_type(p_type) {        if (!p_type) {            check_input_arr.push(false)        } else {            check_input_arr.push(true)        }    }    function check_p_price(p_price) {        if (!p_price || p_price < 1 || p_price > 10000000) {            $("#p_price_group").addClass("has-danger")            $("#package_price").addClass("form-control-danger")            check_input_arr.push(false)        } else {            $("#p_price_group").removeClass("has-danger")            $("#package_price").removeClass("form-control-danger")            check_input_arr.push(true)        }    }    function check_p_image(p_image) {        if (!p_image) {            check_input_arr.push(false)            alert("Invalid file");            e.preventDefault();        } else {            check_input_arr.push(true)        }    }    function showProgressBarEdit() {        $("#progress_div_edit").append("<div id='progress_bar' class='progress-bar progress-bar-striped progress-bar-animated'  role='progressbar' aria-valuenow='75' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>")        $("#progress_div_edit").after("<small class='text-muted'>Uploading Image...</small>")    }    function showProgressBar() {        $("#progress_div").append("<div id='progress_bar' class='progress-bar progress-bar-striped progress-bar-animated'  role='progressbar' aria-valuenow='75' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>")        $("#progress_div").after("<small class='text-muted'>Uploading Image...</small>")    }    document.getElementById('get_file').onclick = function () {        document.getElementById('my_file').click();    }    document.getElementById('my_file').onchange = function () {        var p_image = document.getElementById('my_file');        if (!(/^image\/.+$/).test(p_image.files[0].type)) {            alert("Invalid file");            e.preventDefault();        }        document.getElementById('text_image').value = this.value.substr(12, this.value.length);    }    document.getElementById('get_file_edit').onclick = function () {        document.getElementById('my_file_edit').click();    }    document.getElementById('my_file_edit').onchange = function () {        var p_image = document.getElementById('my_file_edit');        if (!(/^image\/.+$/).test(p_image.files[0].type)) {            alert("Invalid file");            e.preventDefault();        }        document.getElementById('text_image_edit').value = this.value.substr(12, this.value.length);    }    function signout_dialog() {        var r = confirm("Do you really want to sign out?");        if (r == false) {            return false        }    }</script></body></html>